

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyphi_plots.pyphi_plots &mdash; PyPhi 4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=71af5d5d"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            PyPhi
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">pyphi-master</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PyPhi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pyphi_plots.pyphi_plots</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pyphi_plots.pyphi_plots</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Plots for pyPhi</span>

<span class="sd">@author: Sal Garcia &lt;sgarciam@ic.ac.uk&gt; &lt;salvadorgarciamunoz@gmail.com&gt;</span>
<span class="sd">Addition on Jan 20 2025  Added barplot and lineplot</span>
<span class="sd">Addition on Apr 29 2024  Made it compatible with Bokeh 3.4.1 replacing &quot;circle&quot; with &quot;scatter&quot;</span>
<span class="sd">Addition on Feb 24 2024  Replaced the randon number in the file names with a time string.</span>
<span class="sd">Addition on Feb 21 2024  Added ability to make score plots with a gradient color</span>
<span class="sd">                         of nbins based on a numerical value in the classids </span>
<span class="sd">Addition on Jan 18 2024  Added flag to score_scatter to include model scores in plot</span>
<span class="sd">                         replaced phi.unique -&gt; np.unique</span>
<span class="sd">                         Updated call to maptplotlib colormap to keep it compatible</span>
<span class="sd">                         </span>
<span class="sd">Addition on Sep 26 2023  All plots are now viewable offline (e.g. in airplane mode)</span>
<span class="sd">Addition on May 1 2023   corrected description of mb_vip</span>
<span class="sd">Addition on Apr 25 2023  added markersize to score_scatter</span>
<span class="sd">Addition on Apr 23 2023  also added the text_alpha flag to loadings map for PCA models</span>
<span class="sd">Addition on Apr 22 2023  added tooltips to contribution plots and VIP</span>
<span class="sd">                         implemented multiple columns in score scatter (yay!)</span>

<span class="sd">Addition on Apr 17 2023  added tpls to the supported models in all loadings, vip, r2pv </span>
<span class="sd">                         and score_scatter plots</span>
<span class="sd">Addition on Apr 15 2023, made all loadings, vip, r2pv and score_scatter compatible with</span>
<span class="sd">                         lpls and jrpls models</span>
<span class="sd">Addition on April 9 2023,  added legends and pan tools to r2pv (yay!)</span>
<span class="sd">Addition on April 8 2023, fixed predvsobs to take MB data</span>

<span class="sd">Release Nov 15 2021</span>
<span class="sd">    * Added &quot;xgrid&quot; flag to all plots using bar plots (loadings, weighted loadings, contributions) to add the Xgrid lines to the plot</span>

<span class="sd">Release Jan 15, 2021</span>
<span class="sd">    * Added mb_blockweights plot for MBPSL models</span>
<span class="sd">    </span>
<span class="sd">Release Date: March 30 2020</span>
<span class="sd">    * Fixed small syntax change for Bohek to stay compatible</span>

<span class="sd">Release Date: Aug 22 2019</span>

<span class="sd">What was done:</span>
<span class="sd">    </span>
<span class="sd">    * This header is now included to track high level changes </span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">show</span><span class="p">,</span> <span class="n">output_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.plotting</span><span class="w"> </span><span class="kn">import</span> <span class="n">figure</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.layouts</span><span class="w"> </span><span class="kn">import</span> <span class="n">column</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">bokeh.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ColumnDataSource</span><span class="p">,</span><span class="n">LabelSet</span><span class="p">,</span><span class="n">Span</span><span class="p">,</span><span class="n">Legend</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyphi</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">phi</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="c1">#import matplotlib.cm as cm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>

<div class="viewcode-block" id="timestr">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.timestr">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">timestr</span><span class="p">():</span>
    <span class="n">now</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span></div>

    

<div class="viewcode-block" id="r2pv">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.r2pv">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">r2pv</span><span class="p">(</span><span class="n">mvm_obj</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span><span class="n">addtitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">material</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">zspace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;R2 per variable per component plots</span>
<span class="sd">    </span>
<span class="sd">    r2pv(mvm_obj,*,plotwidth=600,plotheight=400,addtitle=&#39;&#39;,material=False,zspace=False)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvm_obj: A model created with phi.pca or phi.pls</span>
<span class="sd">    </span>
<span class="sd">    Other Parameters:</span>
<span class="sd">        material: To obtain the plot for the properties of a specific material</span>
<span class="sd">                  When doing this for a JRPLS or TPLS mode</span>
<span class="sd">        zspace:  If True will display the r2pv for the process space in a TPLS model</span>
<span class="sd">        </span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mvmobj</span><span class="o">=</span><span class="n">mvm_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">A</span><span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">yaxlbl</span><span class="o">=</span><span class="s1">&#39;X&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpv&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpvi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)]</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidXi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)</span> <span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">zspace</span> <span class="p">:</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpv&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2zpv&#39;</span><span class="p">]</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidZ&#39;</span><span class="p">]</span>
            <span class="n">yaxlbl</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_varX</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">is_pls</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;LV #&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_pls</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;PC #&#39;</span>
        
    <span class="n">lv_labels</span> <span class="o">=</span> <span class="p">[]</span>   
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lv_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lv_prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>    
    

    <span class="k">if</span> <span class="s1">&#39;varidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">r2pvX_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;XVar&#39;</span><span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]}</span>
        <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">XVar</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varX</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
        <span class="n">r2pvX_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;XVar&#39;</span><span class="p">:</span> <span class="n">XVar</span><span class="p">}</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
        <span class="n">r2pvX_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpv&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
        
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">num_varY</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;varidY&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">r2pvY_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;YVar&#39;</span><span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]}</span>
            <span class="n">YVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">YVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varY</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">YVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;YVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
            <span class="n">r2pvY_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;YVar&#39;</span><span class="p">:</span> <span class="n">YVar</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">r2pvY_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2ypv&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
            
    
    <span class="k">if</span> <span class="n">is_pls</span><span class="p">:</span>
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;r2xypv_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;R2&quot;</span><span class="o">+</span> <span class="n">yaxlbl</span><span class="o">+</span> <span class="s2">&quot;YPV&quot;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
        <span class="c1">#colormap =cm.get_cmap(&quot;rainbow&quot;)</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s1">&#39;rainbow&#39;</span><span class="p">]</span>
        <span class="n">different_colors</span><span class="o">=</span><span class="n">A</span>
        <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bokeh_palette</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#</span><span class="si">%02x%02x%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">color_mapping</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span>  
        
        
            
        <span class="n">px</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;R2&quot;</span><span class="o">+</span> <span class="n">yaxlbl</span><span class="o">+</span><span class="s2">&quot; Per Variable &quot;</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
             <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,xpan,hover,reset&quot;</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="s2">&quot;$name @XVar: @$name&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">)</span>
        
        <span class="n">v</span><span class="o">=</span><span class="n">px</span><span class="o">.</span><span class="n">vbar_stack</span><span class="p">(</span><span class="n">lv_labels</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;XVar&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">bokeh_palette</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">r2pvX_dict</span><span class="p">)</span>
        <span class="n">px</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">px</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">minor_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;R2&#39;</span><span class="o">+</span> <span class="n">yaxlbl</span>
        <span class="n">px</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lv_labels</span><span class="p">)],</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">px</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">YVar</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;R2Y Per Variable &quot;</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,xpan,hover,reset&quot;</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="s2">&quot;$name @YVar: @$name&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
        
        <span class="n">v</span><span class="o">=</span><span class="n">py</span><span class="o">.</span><span class="n">vbar_stack</span><span class="p">(</span><span class="n">lv_labels</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;YVar&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">bokeh_palette</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">r2pvY_dict</span><span class="p">)</span>
        <span class="n">py</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">py</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">py</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">minor_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">py</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">py</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">py</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;R2Y&#39;</span>
        <span class="n">py</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lv_labels</span><span class="p">)],</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">py</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">px</span><span class="p">,</span><span class="n">py</span><span class="p">))</span>
        
        
    <span class="k">else</span><span class="p">:</span>   
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;r2xpv_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;R2XPV&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
        <span class="c1">#colormap =cm.get_cmap(&quot;rainbow&quot;)</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s1">&#39;rainbow&#39;</span><span class="p">]</span>
        <span class="n">different_colors</span><span class="o">=</span><span class="n">A</span>
        <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bokeh_palette</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#</span><span class="si">%02x%02x%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">color_mapping</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span>  
               
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;R2X Per Variable &quot;</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
             <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,xpan,hover,reset&quot;</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="s2">&quot;$name @XVar: @$name&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">)</span>
        
        <span class="n">v</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">vbar_stack</span><span class="p">(</span><span class="n">lv_labels</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;XVar&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">bokeh_palette</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">r2pvX_dict</span><span class="p">)</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lv_labels</span><span class="p">)],</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">p</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">minor_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">p</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;R2X&#39;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span></div>

    
<div class="viewcode-block" id="loadings">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.loadings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">loadings</span><span class="p">(</span><span class="n">mvm_obj</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">xgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">addtitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">material</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">zspace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Column plots of loadings</span>
<span class="sd">    </span>
<span class="sd">    loadings(mvm_obj,*,plotwidth=600,xgrid=False,addtitle=&#39;&#39;,material=False,zspace=False)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvm_obj: A PCA,PLS, LPLS, JPLS or TPLS model </span>
<span class="sd">        </span>
<span class="sd">    Other Parameters:</span>
<span class="sd">        material: To obtain the plot for the properties of a specific material</span>
<span class="sd">                  When doing this for a JRPLS or TPLS mode     </span>
<span class="sd">        zspace:  If True will display the plot for the process space in a TPLS model</span>

<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mvmobj</span><span class="o">=</span><span class="n">mvm_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">space_lbl</span><span class="o">=</span><span class="s1">&#39;X&#39;</span>
    <span class="n">A</span><span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">):</span>
        <span class="n">loading_lbl</span><span class="o">=</span><span class="s1">&#39;S*&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ss&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">zspace</span><span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ss&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ssi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)]</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidXi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)</span> <span class="p">]</span>
            
        <span class="k">elif</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">zspace</span> <span class="p">:</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidZ&#39;</span><span class="p">]</span>
            <span class="n">loading_lbl</span><span class="o">=</span><span class="s1">&#39;Wz*&#39;</span>
            <span class="n">space_lbl</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_varX</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    
        <span class="n">loading_lbl</span><span class="o">=</span><span class="s1">&#39;W*&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">is_pls</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;LV #&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_pls</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;PC #&#39;</span>       
    <span class="n">lv_labels</span> <span class="o">=</span> <span class="p">[]</span>   
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lv_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lv_prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>    
    <span class="k">if</span> <span class="s1">&#39;varidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">X_loading_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;XVar&#39;</span><span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]}</span>
        <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">XVar</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varX</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
        <span class="n">X_loading_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;XVar&#39;</span><span class="p">:</span> <span class="n">XVar</span><span class="p">}</span>
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">X_loading_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
            
        <span class="n">num_varY</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;varidY&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">Q_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;YVar&#39;</span><span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]}</span>
            <span class="n">YVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">YVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varY</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">YVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;YVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
            <span class="n">Q_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;YVar&#39;</span><span class="p">:</span> <span class="n">YVar</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">Q_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">X_loading_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
            
    <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
    <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Variable:&quot;</span><span class="p">,</span><span class="s2">&quot;@names&quot;</span><span class="p">)</span>
                <span class="p">]</span>
      
    <span class="k">if</span> <span class="n">is_pls</span><span class="p">:</span>
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Loadings &quot;</span><span class="o">+</span><span class="n">space_lbl</span><span class="o">+</span><span class="s2">&quot; Space_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">space_lbl</span><span class="o">+</span><span class="s1">&#39; Loadings PLS&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">space_lbl</span><span class="o">+</span><span class="s2">&quot; Space Loadings &quot;</span><span class="o">+</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
                    <span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
            <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span> 
            
            <span class="c1">#p.vbar(x=XVar, top=mvmobj[&#39;Ws&#39;][:,i].tolist(), width=0.5)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="k">if</span> <span class="n">xgrid</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
                
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">loading_lbl</span><span class="o">+</span><span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>    
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Loadings Y Space_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y Loadings PLS&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">YVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Y Space Loadings &quot;</span><span class="o">+</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
                    <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,pan,reset&quot;</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
            
            <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">YVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">YVar</span><span class="p">))</span> 
            <span class="c1">#p.vbar(x=YVar, top=mvmobj[&#39;Q&#39;][:,i].tolist(), width=0.5)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="k">if</span> <span class="n">xgrid</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Q [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>                    
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>   
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Loadings X Space_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X Loadings PCA&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span>  
            
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;X Space Loadings &quot;</span><span class="o">+</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
                    <span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
            
            <span class="c1">#p.vbar(x=XVar, top=mvmobj[&#39;P&#39;][:,i].tolist(), width=0.5)</span>
            
            <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xgrid</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;P [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
    <span class="k">return</span>    </div>


<div class="viewcode-block" id="loadings_map">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.loadings_map">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">loadings_map</span><span class="p">(</span><span class="n">mvm_obj</span><span class="p">,</span><span class="n">dims</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">addtitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">material</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">zspace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">textalpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scatter plot overlaying X and Y loadings </span>
<span class="sd">    </span>
<span class="sd">    loadings_map(mvm_obj,dims,*,plotwidth=600,addtitle=&#39;&#39;,material=False,zspace=False,textalpha=0.75)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvm_obj: A PCA,PLS, LPLS, JPLS or TPLS model </span>
<span class="sd">        dims: Dimensions to plot in x and y axis (e.g. [1,2])</span>
<span class="sd">        </span>
<span class="sd">    Other Parameters:</span>
<span class="sd">        material: To obtain the plot for the properties of a specific material</span>
<span class="sd">          When doing this for a JRPLS or TPLS mode     </span>
<span class="sd">          zspace:  If True will display the plot for the process space in a TPLS model</span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mvmobj</span><span class="o">=</span><span class="n">mvm_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">A</span><span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">):</span>
     
        <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ss&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">zspace</span><span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ss&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ssi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)]</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidXi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)</span> <span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">zspace</span> <span class="p">:</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidZ&#39;</span><span class="p">]</span>
            
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_varX</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;LV #&#39;</span>     
        <span class="n">lv_labels</span> <span class="o">=</span> <span class="p">[]</span>   
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">lv_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lv_prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>    
        <span class="k">if</span> <span class="s1">&#39;varidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">XVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varX</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
        <span class="n">num_varY</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;varidY&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">YVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">YVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varY</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">YVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;YVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
    
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Loadings Map&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Loadings Map&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>
       
    
        <span class="n">x_ws</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">][:,</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x_ws</span> <span class="o">=</span> <span class="n">x_ws</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x_ws</span><span class="p">))</span>
        <span class="n">y_ws</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">][:,</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_ws</span> <span class="o">=</span> <span class="n">y_ws</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_ws</span><span class="p">))</span>
        
        <span class="n">x_q</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][:,</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x_q</span> <span class="o">=</span> <span class="n">x_q</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x_q</span><span class="p">))</span>   
        <span class="n">y_q</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][:,</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_q</span> <span class="o">=</span> <span class="n">y_q</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y_q</span><span class="p">))</span>
        
        
        <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
        <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;$index&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Variable:&quot;</span><span class="p">,</span><span class="s2">&quot;@names&quot;</span><span class="p">)</span>
                <span class="p">]</span>
    
        <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_ws</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_ws</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span>  
        <span class="n">source2</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_q</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_q</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">YVar</span><span class="p">))</span> 
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Loadings Map LV[&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;] - LV[&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;] &quot;</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
                                                                                                          <span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span><span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">))</span>
        <span class="c1">#p.circle(&#39;x&#39;, &#39;y&#39;, source=source1,size=10,color=&#39;darkblue&#39;)</span>
        <span class="c1">#p.circle(&#39;x&#39;, &#39;y&#39;, source=source2,size=10,color=&#39;red&#39;)</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source2</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">lv_labels</span> <span class="p">[</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">lv_labels</span> <span class="p">[</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">labelsX</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> 
                           <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">,</span><span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                           <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">text_color</span><span class="o">=</span><span class="s1">&#39;darkgray&#39;</span><span class="p">,</span>
                           <span class="n">text_alpha</span><span class="o">=</span><span class="n">textalpha</span> <span class="p">)</span>
        <span class="n">labelsY</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> 
                           <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">,</span><span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                           <span class="n">source</span><span class="o">=</span><span class="n">source2</span><span class="p">,</span><span class="n">text_color</span><span class="o">=</span><span class="s1">&#39;darkgray&#39;</span><span class="p">,</span>
                           <span class="n">text_alpha</span><span class="o">=</span><span class="n">textalpha</span> <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labelsX</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labelsY</span><span class="p">)</span>

        <span class="n">vline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Horizontal line</span>
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">vline</span><span class="p">,</span> <span class="n">hline</span><span class="p">])</span>
        <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;PC #&#39;</span>     
        <span class="n">lv_labels</span> <span class="o">=</span> <span class="p">[]</span>   
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">lv_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lv_prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>    
        <span class="k">if</span> <span class="s1">&#39;varidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">XVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varX</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>                   
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Loadings Map&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Loadings Map&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>    
        <span class="n">x_p</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][:,</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_p</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][:,</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                        
        <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
        <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;$index&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Variable:&quot;</span><span class="p">,</span><span class="s2">&quot;@names&quot;</span><span class="p">)</span>
                <span class="p">]</span>
    
        <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_p</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_p</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span>  
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Loadings Map PC[&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;] - PC[&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;] &quot;</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>                                                                                                         <span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span><span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">))</span>
        <span class="c1">#p.circle(&#39;x&#39;, &#39;y&#39;, source=source1,size=10,color=&#39;darkblue&#39;)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">lv_labels</span> <span class="p">[</span><span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">lv_labels</span> <span class="p">[</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        
        <span class="n">labelsX</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;names&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">,</span><span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span> 
                          <span class="n">text_color</span><span class="o">=</span><span class="s1">&#39;darkgray&#39;</span><span class="p">,</span><span class="n">text_alpha</span><span class="o">=</span><span class="n">textalpha</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labelsX</span><span class="p">)</span>
        <span class="n">vline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Horizontal line</span>
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">vline</span><span class="p">,</span> <span class="n">hline</span><span class="p">])</span>
        <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>            
    <span class="k">return</span>  </div>


<div class="viewcode-block" id="weighted_loadings">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.weighted_loadings">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">weighted_loadings</span><span class="p">(</span><span class="n">mvm_obj</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">xgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">addtitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">material</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">zspace</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Column plots of loadings weighted by r2x/r2y correspondingly</span>
<span class="sd">    </span>
<span class="sd">    weighted_loadings(mvm_obj,*,plotwidth=600,xgrid=False,addtitle=&#39;&#39;,material=False,zspace=False):</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvm_obj: A PCA,PLS, LPLS, JPLS or TPLS model </span>
<span class="sd">        </span>
<span class="sd">    Other Parameters:</span>
<span class="sd">        material: To obtain the plot for the properties of a specific material</span>
<span class="sd">                  When doing this for a JRPLS or TPLS mode     </span>
<span class="sd">        zspace:  If True will display the plot for the process space in a TPLS model</span>

<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mvmobj</span><span class="o">=</span><span class="n">mvm_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">A</span><span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">space_lbl</span><span class="o">=</span><span class="s1">&#39;X&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">):</span>
        <span class="n">loading_lbl</span><span class="o">=</span><span class="s1">&#39;S*&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ss&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">zspace</span><span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ss&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span>  <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="p">):</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ssi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)]</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidXi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)</span> <span class="p">]</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpv&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpvi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)</span> <span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">zspace</span><span class="p">:</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidZ&#39;</span><span class="p">]</span>
            <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpv&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2zpv&#39;</span><span class="p">]</span>
            <span class="n">loading_lbl</span><span class="o">=</span><span class="s1">&#39;Wz*&#39;</span>
            <span class="n">space_lbl</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_varX</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>     
        <span class="n">loading_lbl</span><span class="o">=</span><span class="s1">&#39;W*&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">is_pls</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;LV #&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_pls</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;PC #&#39;</span>       
    <span class="n">lv_labels</span> <span class="o">=</span> <span class="p">[]</span>   
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lv_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lv_prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>    
    <span class="k">if</span> <span class="s1">&#39;varidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">X_loading_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;XVar&#39;</span><span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]}</span>
        <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">XVar</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varX</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
        <span class="n">X_loading_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;XVar&#39;</span><span class="p">:</span> <span class="n">XVar</span><span class="p">}</span>
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">X_loading_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
            
        <span class="n">num_varY</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;varidY&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">Q_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;YVar&#39;</span><span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]}</span>
            <span class="n">YVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">YVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varY</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">YVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;YVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
            <span class="n">Q_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;YVar&#39;</span><span class="p">:</span> <span class="n">YVar</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">Q_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">X_loading_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
            
    <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
    <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Variable:&quot;</span><span class="p">,</span><span class="s2">&quot;@names&quot;</span><span class="p">)</span>
                <span class="p">]</span>
    
    <span class="k">if</span> <span class="n">is_pls</span><span class="p">:</span>
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Loadings &quot;</span><span class="o">+</span><span class="n">space_lbl</span><span class="o">+</span><span class="s2">&quot; Space_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">space_lbl</span><span class="o">+</span><span class="s1">&#39; Weighted Loadings PLS&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">space_lbl</span><span class="o">+</span><span class="s2">&quot; Space Weighted Loadings &quot;</span><span class="o">+</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
                     <span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
            <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpv&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span> 
             
            <span class="c1">#p.vbar(x=XVar, top=(mvmobj[&#39;r2xpv&#39;][:,i] * mvmobj[&#39;Ws&#39;][:,i]).tolist(), width=0.5)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="k">if</span> <span class="n">xgrid</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    

            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">loading_lbl</span><span class="o">+</span><span class="s1">&#39; x R2&#39;</span><span class="o">+</span><span class="n">space_lbl</span><span class="o">+</span><span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span> 
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Loadings Y Space_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y Weighted Loadings PLS&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">YVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Y Space Weighted Loadings &quot;</span><span class="o">+</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
                     <span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
            <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">YVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2ypv&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">YVar</span><span class="p">))</span> 
            
            <span class="c1">#p.vbar(x=YVar, top=(mvmobj[&#39;r2ypv&#39;][:,i] * mvmobj[&#39;Q&#39;][:,i]).tolist(), width=0.5)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="k">if</span> <span class="n">xgrid</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Q x R2Y [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>                    
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>   
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Loadings X Space_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X Weighted Loadings PCA&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;X Space Weighted Loadings &quot;</span><span class="o">+</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
                     <span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
            <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2xpv&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span> 
            
            <span class="c1">#p.vbar(x=XVar, top=(mvmobj[&#39;r2xpv&#39;][:,i] * mvmobj[&#39;P&#39;][:,i]).tolist(), width=0.5)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
            <span class="k">if</span> <span class="n">xgrid</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    

            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;P x R2X[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
    <span class="k">return</span>  </div>

 
<div class="viewcode-block" id="vip">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.vip">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">vip</span><span class="p">(</span><span class="n">mvm_obj</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">material</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">zspace</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">addtitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Very Important to the Projection (VIP) plot</span>
<span class="sd">    </span>
<span class="sd">    vip(mvm_obj,*,plotwidth=600,material=False,zspace=False,addtitle=&#39;&#39;)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvm_obj: A PLS, LPLS, JPLS or TPLS model </span>
<span class="sd">        </span>
<span class="sd">    Other Parameters:</span>
<span class="sd">        material: To obtain the plot for the properties of a specific material</span>
<span class="sd">                  When doing this for a JRPLS or TPLS mode     </span>
<span class="sd">        zspace:  If True will display the vip for the process space in a TPLS model</span>

<span class="sd">        by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    </span>
<span class="sd">    mvm_obj: A model created with phi.pls</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mvmobj</span><span class="o">=</span><span class="n">mvm_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>  
        <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">):</span>
                <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ss&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">zspace</span><span class="p">):</span>
                <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ss&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="p">):</span>
                <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ssi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)]</span>
                <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidXi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)</span> <span class="p">]</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">zspace</span><span class="p">:</span>
                <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidZ&#39;</span><span class="p">]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_varX</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;VIP_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;VIP Coefficient&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
                   
        <span class="k">if</span> <span class="s1">&#39;varidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">XVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varX</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
        
        <span class="n">vip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2y&#39;</span><span class="p">],(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Ws&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span> <span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vip</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">vip</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">sort_indx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">vip</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">vip</span><span class="o">=</span><span class="n">vip</span><span class="p">[</span><span class="n">sort_indx</span><span class="p">]</span>
        <span class="n">sorted_XVar</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sort_indx</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">sorted_XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">XVar</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  
            
        <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="s2">&quot;Variable&quot;</span><span class="p">,</span><span class="s2">&quot;@names&quot;</span><span class="p">)</span>
                    <span class="p">]</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">sorted_XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;VIP &quot;</span><span class="o">+</span><span class="n">addtitle</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,pan,reset&quot;</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
        <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">sorted_XVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">vip</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">sorted_XVar</span><span class="p">))</span> 
        <span class="c1">#p.vbar(x=sorted_XVar, top=vip.tolist(), width=0.5)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Very Important to the Projection&#39;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span>    </div>


<span class="k">def</span><span class="w"> </span><span class="nf">_create_classid_</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">nbins</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Internal routine to create a CLASSID dataframe from values in a column</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">hist</span><span class="p">,</span><span class="n">bin_edges</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span><span class="n">bins</span><span class="o">=</span><span class="n">nbins</span> <span class="p">)</span>
    <span class="n">range_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">range_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; to &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="mi">3</span><span class="p">)))</span>
    <span class="c1">#range_list.append(&#39;NaN&#39;)</span>
    <span class="n">bin_edges_</span><span class="o">=</span><span class="n">bin_edges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">bin_edges_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">bin_edges_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span>
    <span class="n">membership_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">bin_edges_</span><span class="p">)</span>
    <span class="n">membership</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">membership_</span><span class="p">:</span>
        <span class="n">membership</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">range_list</span><span class="p">[</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">classid_df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
    <span class="n">classid_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="n">membership</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">classid_df</span>

<div class="viewcode-block" id="score_scatter">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.score_scatter">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">score_scatter</span><span class="p">(</span><span class="n">mvm_obj</span><span class="p">,</span><span class="n">xydim</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">CLASSID</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">colorby</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Xnew</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">add_ci</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">add_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">legend_cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                  <span class="n">addtitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                  <span class="n">rscores</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">material</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">marker_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">nbins</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">include_model</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Score scatter plot</span>
<span class="sd">    </span>
<span class="sd">    score_scatter(mvm_obj,xydim,*,CLASSID=False,colorby=False,nbins=False,Xnew=False,</span>
<span class="sd">                      add_ci=False,add_labels=False,add_legend=True,legend_cols=1, </span>
<span class="sd">                      addtitle=&#39;&#39;,plotwidth=600,plotheight=600,</span>
<span class="sd">                      rscores=False,material=False,marker_size=7,include_model=False):</span>
<span class="sd">    Args:</span>
<span class="sd">        mvm_obj     : PLS or PCA object from phyphi</span>
<span class="sd">        xydim      : LV to plot on x and y axes. eg [1,2] will plot t1 vs t2</span>
<span class="sd">        CLASSID    : Pandas DataFrame with CLASSIDS</span>
<span class="sd">        colorby    : Category (one of the CLASSIDS) to color by</span>
<span class="sd">        Xnew       : New data for which to make the score plot this routine evaluates and plots</span>
<span class="sd">        nbins      : Number of groups to use when color coding by a numeric value</span>
<span class="sd">        add_ci     : when = True will add confidence intervals</span>
<span class="sd">        add_labels : When = True labels each point with Obs ID</span>
<span class="sd">        add_legend : When = True will add a legend with classid labels</span>
<span class="sd">        legend_cols: Number of columns for legend</span>
<span class="sd">        addtitle   : Additional text to be added to title</span>
<span class="sd">        plotwidth  : If omitted, width is 600</span>
<span class="sd">        plotheight : If omitted, height is 600</span>
<span class="sd">        rscores    : Plot scores for all material space in lpls|jrpls|tpls</span>
<span class="sd">        material   : Label for specific material to plot scores for in lpls|jrpls|tpls </span>
<span class="sd">        include_model: Will plot model scores in gray as backgrpound</span>
<span class="sd">        </span>
<span class="sd">    by Salvador Garcia Munoz (sgarciam@imperial.ac.uk salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nbins</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
         <span class="k">if</span> <span class="n">colorby</span> <span class="ow">in</span> <span class="n">CLASSID</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
             <span class="n">classid_by_var</span> <span class="o">=</span> <span class="n">_create_classid_</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">,</span><span class="n">colorby</span><span class="p">,</span><span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
             <span class="n">CLASSID</span> <span class="o">=</span> <span class="n">classid_by_var</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
             
    <span class="n">mvmobj</span><span class="o">=</span><span class="n">mvm_obj</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">)</span> <span class="ow">or</span>  <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span>  <span class="ow">or</span>  <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="nb">bool</span><span class="p">))):</span>    
        <span class="n">Xnew</span><span class="o">=</span><span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;score scatter does not take Xnew for jrpls or lpls for now&#39;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="s1">&#39;obsidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">ObsID_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidX&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ObsID_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
        <span class="n">T_matrix</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>    
        
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">rscores</span><span class="p">):</span>        
            <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">):</span>
                <span class="n">ObsID_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidR&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">)</span> <span class="p">:</span>   
                 <span class="n">ObsID_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidRi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;lpls&#39;</span><span class="p">):</span>
                <span class="n">ObsID_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidX&#39;</span><span class="p">]</span>
                <span class="n">T_matrix</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Rscores&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;jrpls&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;tpls&#39;</span><span class="p">)</span>  <span class="p">:</span> 
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
                    <span class="n">allobsids</span><span class="o">=</span><span class="p">[</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidXi&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
                    <span class="n">ObsID_</span><span class="o">=</span><span class="n">allobsids</span>
                    <span class="n">clssid_obs</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">clssid_class</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">R_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Rscores&#39;</span><span class="p">]):</span>
                        <span class="n">clssid_obs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidXi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">clssid_class</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidXi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                            <span class="n">allrscores</span><span class="o">=</span><span class="n">R_</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">allrscores</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">allrscores</span><span class="p">,</span><span class="n">R_</span><span class="p">))</span>
                    <span class="n">classid</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">clssid_class</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;material&#39;</span><span class="p">])</span>
                    <span class="n">classid</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;obs&#39;</span><span class="p">,</span><span class="n">clssid_obs</span><span class="p">)</span>
                    <span class="n">CLASSID</span><span class="o">=</span><span class="n">classid</span>
                    <span class="n">colorby</span><span class="o">=</span><span class="s1">&#39;material&#39;</span>
                    <span class="n">T_matrix</span><span class="o">=</span><span class="n">allrscores</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidXi&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)</span> <span class="p">]</span>
                    <span class="n">T_matrix</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Rscores&#39;</span><span class="p">][</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;materials&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">material</span><span class="p">)</span> <span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">X_</span><span class="o">=</span><span class="n">Xnew</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Xnew</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ObsID_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">X_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Xnew</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">Xnew</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">ObsID_</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>  
            <span class="n">xpred</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">pls_pred</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xpred</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">pca_pred</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">)</span>
        <span class="n">T_matrix</span><span class="o">=</span><span class="n">xpred</span><span class="p">[</span><span class="s1">&#39;Tnew&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">include_model</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;obsidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">ObsID__</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ObsID__</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ObsID__</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Model Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
        <span class="n">T_matrix_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    
      
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span> <span class="c1">#If there are no classids I need to create one</span>
            <span class="n">source</span><span class="o">=</span><span class="p">([</span><span class="s1">&#39;Model&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">T_matrix_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">source</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;New&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">T_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ObsID__</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">)</span>
            <span class="n">CLASSID</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span> <span class="p">{</span><span class="s1">&#39;ObsID&#39;</span><span class="p">:</span><span class="n">ObsID__</span><span class="p">,</span><span class="s1">&#39;_Source_&#39;</span><span class="p">:</span><span class="n">source</span> <span class="p">})</span>
            <span class="n">colorby</span><span class="o">=</span><span class="s1">&#39;_Source_&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#IF there are I need to augment it</span>
            <span class="n">source</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">T_matrix_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">CLASSID_</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span> <span class="p">{</span><span class="n">CLASSID</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">ObsID__</span><span class="p">,</span><span class="n">colorby</span><span class="p">:</span><span class="n">source</span> <span class="p">})</span>
            <span class="n">ObsID__</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">)</span>
            <span class="n">CLASSID</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">CLASSID_</span><span class="p">,</span><span class="n">CLASSID</span><span class="p">])</span>
        <span class="n">ObsID_</span><span class="o">=</span><span class="n">ObsID__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    
        <span class="n">T_matrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">T_matrix_</span><span class="p">,</span><span class="n">T_matrix</span> <span class="p">))</span>
    <span class="n">ObsNum_</span><span class="o">=</span><span class="p">[]</span>    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">ObsNum_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span> <span class="c1"># No CLASSIDS</span>
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Score_Scatter_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Scatter t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;] - t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>

        <span class="n">x_</span><span class="o">=</span><span class="n">T_matrix</span><span class="p">[:,[</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">y_</span><span class="o">=</span><span class="n">T_matrix</span><span class="p">[:,[</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

           
        <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">ObsNum_</span><span class="p">))</span>
        <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
        <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Obs #&quot;</span><span class="p">,</span> <span class="s2">&quot;@ObsNum&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Obs: &quot;</span><span class="p">,</span><span class="s2">&quot;@ObsID&quot;</span><span class="p">)</span>
                <span class="p">]</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Scatter t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;] - t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span> <span class="s1">&#39;] &#39;</span><span class="o">+</span><span class="n">addtitle</span><span class="p">)</span>
        <span class="c1">#p.circle(&#39;x&#39;, &#39;y&#39;, source=source,size=marker_size)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">marker_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_ci</span><span class="p">:</span>
            <span class="n">T_aux1</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">T_aux2</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">T_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">T_aux1</span><span class="p">,</span><span class="n">T_aux2</span><span class="p">))</span>
            <span class="n">st</span><span class="o">=</span><span class="p">(</span><span class="n">T_aux</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">T_aux</span><span class="p">)</span><span class="o">/</span><span class="n">T_aux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">[</span><span class="n">xd95</span><span class="p">,</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd95p</span><span class="p">,</span><span class="n">yd95n</span><span class="p">,</span><span class="n">yd99p</span><span class="p">,</span><span class="n">yd99n</span><span class="p">]</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">scores_conf_int_calc</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd95</span><span class="p">,</span><span class="n">yd95p</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd95</span><span class="p">,</span><span class="n">yd95n</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd99p</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd99n</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">add_labels</span><span class="p">:</span>
            <span class="n">labelsX</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;ObsID&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">,</span><span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labelsX</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">rscores</span><span class="p">):</span>    
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;t [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;t [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;r [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;r [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="c1"># Vertical line</span>
        <span class="n">vline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Horizontal line</span>
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">vline</span><span class="p">,</span> <span class="n">hline</span><span class="p">])</span>
        <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>      
    <span class="k">else</span><span class="p">:</span> <span class="c1"># YES CLASSIDS   </span>
        <span class="n">Classes_</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">,</span><span class="n">colorby</span><span class="p">)</span>
        <span class="n">A</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">Classes_</span><span class="p">)</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s1">&#39;rainbow&#39;</span><span class="p">]</span>
        <span class="n">different_colors</span><span class="o">=</span><span class="n">A</span>
        <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#Test code to overwrite &quot;Model&quot; Category with light Cyan</span>
        <span class="k">if</span> <span class="n">Classes_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Model&#39;</span><span class="p">:</span>
            <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">color_mapping</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">225</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">255</span><span class="p">]),</span><span class="n">color_mapping</span><span class="p">))</span>
            
            
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nbins</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)):</span>
             <span class="k">if</span> <span class="n">colorby</span> <span class="ow">in</span> <span class="n">CLASSID</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
                 <span class="c1">#Classes_=phi.unique(CLASSID,colorby)</span>
                 <span class="n">Classes_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">[</span><span class="n">colorby</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                 <span class="n">item_o</span><span class="o">=</span><span class="p">[]</span>
                 <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Classes_</span><span class="p">:</span>
                     <span class="n">item_o</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="p">[:</span><span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)]))</span>
                 <span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">item_o</span><span class="p">)</span>
                 <span class="n">Classes_o</span><span class="o">=</span><span class="p">[]</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">:</span>
                     <span class="n">Classes_o</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Classes_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                 <span class="n">Classes_</span><span class="o">=</span><span class="n">Classes_o</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>    
                 <span class="c1">#print(Classes_)</span>
                 <span class="n">A</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">Classes_</span><span class="p">)</span>
                 <span class="c1">#colormap =cm.get_cmap(&quot;rainbow&quot;)</span>
                 <span class="n">colormap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s1">&#39;viridis&#39;</span><span class="p">]</span>
                 <span class="n">different_colors</span><span class="o">=</span><span class="n">A</span>
                 <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
                 <span class="k">if</span> <span class="n">Classes_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Model&#39;</span><span class="p">:</span>
                     <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
                     <span class="n">color_mapping</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">225</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">255</span><span class="p">]),</span><span class="n">color_mapping</span><span class="p">))</span>

        <span class="n">bokeh_palette</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#</span><span class="si">%02x%02x%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">color_mapping</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span>  
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))  </span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>         
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Score_Scatter_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Scatter t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;] - t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
        <span class="n">x_</span><span class="o">=</span><span class="n">T_matrix</span><span class="p">[:,[</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">y_</span><span class="o">=</span><span class="n">T_matrix</span><span class="p">[:,[</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>          
        
        <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
        <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Obs #&quot;</span><span class="p">,</span> <span class="s2">&quot;@ObsNum&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Obs: &quot;</span><span class="p">,</span><span class="s2">&quot;@ObsID&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Class:&quot;</span><span class="p">,</span><span class="s2">&quot;@Class&quot;</span><span class="p">)</span>
                <span class="p">]</span>        
<span class="c1">#        if not(isinstance(nbins, bool)):</span>
<span class="c1">#             if colorby in CLASSID.columns.to_list():</span>
<span class="c1">#                 classid_=list(classid_by_var[colorby])</span>
<span class="c1">#        else:</span>
        <span class="n">classid_</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">[</span><span class="n">colorby</span><span class="p">])</span>
        <span class="n">legend_it</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">toolbar_location</span><span class="o">=</span><span class="s2">&quot;above&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Scatter t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;] - t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span> <span class="s1">&#39;] &#39;</span><span class="o">+</span><span class="n">addtitle</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">classid_in_turn</span> <span class="ow">in</span> <span class="n">Classes_</span><span class="p">:</span>                      
            <span class="n">x_aux</span>       <span class="o">=</span> <span class="p">[]</span>
            <span class="n">y_aux</span>       <span class="o">=</span> <span class="p">[]</span>
            <span class="n">obsid_aux</span>   <span class="o">=</span> <span class="p">[]</span>
            <span class="n">obsnum_aux</span>  <span class="o">=</span> <span class="p">[]</span>
            <span class="n">classid_aux</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">))):</span>
                
                <span class="k">if</span> <span class="n">classid_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">classid_in_turn</span><span class="p">:</span>
                    <span class="n">x_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">y_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">obsid_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">obsnum_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObsNum_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">classid_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classid_in_turn</span><span class="p">)</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_aux</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_aux</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">obsid_aux</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">obsnum_aux</span><span class="p">,</span> <span class="n">Class</span><span class="o">=</span><span class="n">classid_aux</span><span class="p">))</span>        
            <span class="n">color_</span><span class="o">=</span><span class="n">bokeh_palette</span><span class="p">[</span><span class="n">Classes_</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">classid_in_turn</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">add_legend</span><span class="p">:</span>
                <span class="c1">#c = p.circle(&#39;x&#39;,&#39;y&#39;,source=source,color=color_,size=marker_size)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">marker_size</span><span class="p">)</span>
                <span class="n">aux_</span><span class="o">=</span><span class="n">classid_in_turn</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aux_</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
                    <span class="n">aux_</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">aux_</span><span class="p">)</span>
                <span class="c1">#legend_it.append((classid_in_turn, [c]))</span>
                <span class="n">legend_it</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">aux_</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#p.circle(&#39;x&#39;,&#39;y&#39;,source=source,color=color_,size=marker_size)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">marker_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_labels</span><span class="p">:</span>
                <span class="n">labelsX</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;ObsID&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">,</span><span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labelsX</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_ci</span><span class="p">:</span>
            <span class="n">T_aux1</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">T_aux2</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">T_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">T_aux1</span><span class="p">,</span><span class="n">T_aux2</span><span class="p">))</span>
            <span class="n">st</span><span class="o">=</span><span class="p">(</span><span class="n">T_aux</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">T_aux</span><span class="p">)</span><span class="o">/</span><span class="n">T_aux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">[</span><span class="n">xd95</span><span class="p">,</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd95p</span><span class="p">,</span><span class="n">yd95n</span><span class="p">,</span><span class="n">yd99p</span><span class="p">,</span><span class="n">yd99n</span><span class="p">]</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">scores_conf_int_calc</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd95</span><span class="p">,</span><span class="n">yd95p</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd95</span><span class="p">,</span><span class="n">yd95n</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd99p</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd99n</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">rscores</span><span class="p">):</span>    
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;t [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;t [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;r [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;r [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="c1"># Vertical line</span>
        <span class="n">vline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Horizontal line</span>
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">vline</span><span class="p">,</span> <span class="n">hline</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">add_legend</span><span class="p">:</span>
            <span class="c1">#legend_cols=1</span>
            <span class="n">ipc</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">legend_it</span><span class="p">)</span><span class="o">/</span><span class="n">legend_cols</span><span class="p">)]</span><span class="o">*</span><span class="n">legend_cols</span>              
            <span class="n">ipc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">legend_it</span><span class="p">)</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">ipc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">pastit</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">ipc</span><span class="p">:</span>
                <span class="n">leg_</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span>
                    <span class="n">items</span><span class="o">=</span><span class="n">legend_it</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="n">pastit</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">pastit</span><span class="o">+</span><span class="n">it</span><span class="p">)])</span>
                    <span class="c1">#location=(0,15+pastit*5))</span>
                <span class="n">pastit</span><span class="o">+=</span><span class="n">it</span>
                <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">leg_</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="n">leg_</span><span class="o">.</span><span class="n">click_policy</span><span class="o">=</span><span class="s2">&quot;hide&quot;</span>
            <span class="c1">#legend = Legend(items=legend_it, location=&#39;top_right&#39;)</span>
            <span class="c1">#p.add_layout(legend, &#39;right&#39;)</span>
            
            
        <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span>    </div>


<div class="viewcode-block" id="score_line">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.score_line">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">score_line</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="n">dim</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">CLASSID</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">colorby</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Xnew</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">add_ci</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">add_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">add_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">plotline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">600</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Score line plot</span>
<span class="sd">    </span>
<span class="sd">    score_line(mvmobj,dim,*,CLASSID=False,colorby=False,Xnew=False,add_ci=False,add_labels=False,add_legend=True,plotline=True,plotwidth=600,plotheight=600):</span>

<span class="sd">    Args:</span>
<span class="sd">        mvmobj     : PLS or PCA object from phyphi</span>
<span class="sd">        dim        : LV to plot eg &quot;1&quot; will plot t1 vs observation #</span>
<span class="sd">        CLASSID    : Pandas DataFrame with CLASSIDS</span>
<span class="sd">        colorby    : Category (one of the CLASSIDS) to color by</span>
<span class="sd">        Xnew       : New data for which to make the score plot this routine evaluates and plots</span>
<span class="sd">        add_ci     : When = True will add confidence intervals</span>
<span class="sd">        add_labels : When =True will display Obs ID per point</span>
<span class="sd">        plotwidth  : When Omitted is = 600</span>
<span class="sd">        plotline   : Adds a conecting line between dots [True by default]</span>
<span class="sd">    </span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
  
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;obsidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">ObsID_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidX&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ObsID_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
        <span class="n">T_matrix</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">X_</span><span class="o">=</span><span class="n">Xnew</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Xnew</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ObsID_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">X_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Xnew</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">Xnew</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">ObsID_</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>  
            <span class="n">xpred</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">pls_pred</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xpred</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">pca_pred</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">)</span>
        <span class="n">T_matrix</span><span class="o">=</span><span class="n">xpred</span><span class="p">[</span><span class="s1">&#39;Tnew&#39;</span><span class="p">]</span>

    <span class="n">ObsNum_</span><span class="o">=</span><span class="p">[]</span>    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">ObsNum_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
                       
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span> <span class="c1"># No CLASSIDS</span>
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Score_Line_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Line t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>

        <span class="n">y_</span><span class="o">=</span><span class="n">T_matrix</span><span class="p">[:,[</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">x_</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

           
        <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">ObsNum_</span><span class="p">))</span>
        <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
        <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Obs#&quot;</span><span class="p">,</span> <span class="s2">&quot;@ObsNum&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Obs: &quot;</span><span class="p">,</span><span class="s2">&quot;@ObsID&quot;</span><span class="p">)</span>
                <span class="p">]</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Line t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span> <span class="p">)</span>
        <span class="c1">#p.circle(&#39;x&#39;, &#39;y&#39;, source=source,size=7)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">plotline</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_ci</span><span class="p">:</span>
            <span class="n">lim95</span><span class="p">,</span><span class="n">lim99</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">single_score_conf_int</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">lim95</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span><span class="o">-</span><span class="n">lim95</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">lim99</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span><span class="o">-</span><span class="n">lim99</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_labels</span><span class="p">:</span>
            <span class="n">labelsX</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;ObsID&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">,</span><span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labelsX</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Observation&#39;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;t [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>      
    <span class="k">else</span><span class="p">:</span> <span class="c1"># YES CLASSIDS</span>
        <span class="c1">#Classes_=np.unique(CLASSID[colorby]).tolist()</span>
        <span class="n">Classes_</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">,</span><span class="n">colorby</span><span class="p">)</span>
        <span class="n">A</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">Classes_</span><span class="p">)</span>
        <span class="c1">#colormap =cm.get_cmap(&quot;rainbow&quot;)</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s1">&#39;rainbow&#39;</span><span class="p">]</span>
        <span class="n">different_colors</span><span class="o">=</span><span class="n">A</span>
        <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bokeh_palette</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#</span><span class="si">%02x%02x%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">color_mapping</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span>  
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))   </span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>            
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Score_Line_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Line t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 

        <span class="n">y_</span><span class="o">=</span><span class="n">T_matrix</span><span class="p">[:,[</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>  
        <span class="n">x_</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">y_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>        
        
        <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
        <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Obs#&quot;</span><span class="p">,</span> <span class="s2">&quot;@ObsNum&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Obs: &quot;</span><span class="p">,</span><span class="s2">&quot;@ObsID&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Class:&quot;</span><span class="p">,</span><span class="s2">&quot;@Class&quot;</span><span class="p">)</span>
                <span class="p">]</span>        
        <span class="n">classid_</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">[</span><span class="n">colorby</span><span class="p">])</span>
        <span class="n">legend_it</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">toolbar_location</span><span class="o">=</span><span class="s2">&quot;above&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Line t[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">classid_in_turn</span> <span class="ow">in</span> <span class="n">Classes_</span><span class="p">:</span>
            <span class="n">x_aux</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">y_aux</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">obsid_aux</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">classid_aux</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">obsnum_aux</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">classid_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">classid_in_turn</span><span class="p">:</span>
                    <span class="n">x_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">y_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">obsid_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">obsnum_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObsNum_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">classid_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classid_in_turn</span><span class="p">)</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_aux</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_aux</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">obsid_aux</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">obsnum_aux</span><span class="p">,</span><span class="n">Class</span><span class="o">=</span><span class="n">classid_aux</span><span class="p">))</span>        
            <span class="n">color_</span><span class="o">=</span><span class="n">bokeh_palette</span><span class="p">[</span><span class="n">Classes_</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">classid_in_turn</span><span class="p">)]</span>
            <span class="c1">#c=p.circle(&#39;x&#39;,&#39;y&#39;,source=source,color=color_)</span>
            <span class="n">c</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">plotline</span><span class="p">:</span>
                <span class="n">c1</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">)</span>    
             <span class="c1">#added to allow numbers in classids   </span>
            <span class="n">aux_</span><span class="o">=</span><span class="n">classid_in_turn</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aux_</span><span class="p">,(</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">)):</span>
                <span class="n">aux_</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">aux_</span><span class="p">)</span>
             <span class="c1">#        </span>
            <span class="k">if</span> <span class="n">add_legend</span> <span class="ow">and</span> <span class="n">plotline</span><span class="p">:</span>    
              <span class="c1">#  legend_it.append((classid_in_turn, [c,c1]))</span>
                <span class="n">legend_it</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">aux_</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="p">,</span><span class="n">c1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">add_legend</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">plotline</span><span class="p">):</span>
              <span class="c1">#  legend_it.append((classid_in_turn, [c]))</span>
                <span class="n">legend_it</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">aux_</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">add_labels</span><span class="p">:</span>
                <span class="n">labelsX</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;ObsID&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s1">&#39;glyph&#39;</span><span class="p">,</span><span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labelsX</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_ci</span><span class="p">:</span>
            <span class="n">lim95</span><span class="p">,</span><span class="n">lim99</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">single_score_conf_int</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">lim95</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span><span class="o">-</span><span class="n">lim95</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">lim99</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span><span class="o">-</span><span class="n">lim99</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>   
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Observation&#39;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;t [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="k">if</span> <span class="n">add_legend</span><span class="p">:</span>
            <span class="n">legend</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">legend_it</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;top_right&#39;</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
            <span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span><span class="o">=</span><span class="s2">&quot;hide&quot;</span>
        <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span>  </div>




<div class="viewcode-block" id="diagnostics">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.diagnostics">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">diagnostics</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">Xnew</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Ynew</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">score_plot_xydim</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">ht2_logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">spe_logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hotelling&#39;s T2 and SPE</span>
<span class="sd">    </span>
<span class="sd">    diagnostics(mvmobj,*,Xnew=False,Ynew=False,score_plot_xydim=False,plotwidth=600,ht2_logscale=False,spe_logscale=False):</span>
<span class="sd"> </span>
<span class="sd">    Args:</span>
<span class="sd">        mvmobj: A model created with phi.pca or phi.pls</span>
<span class="sd">    </span>
<span class="sd">    Optional Parameters:</span>
<span class="sd">        Xnew/Ynew:     Data used to calculate diagnostics[numpy arrays or pandas dataframes] </span>

<span class="sd">        score_plot_xydim: will add a score scatter plot at the bottom </span>
<span class="sd">                          if sent with a list of [dimx, dimy] where dimx/dimy </span>
<span class="sd">                          are integers and refer to the latent space to plot</span>
<span class="sd">                          in the x and y axes of the scatter plot. e.g. [1,2] will</span>
<span class="sd">                          add a t1-t2 plot </span>
<span class="sd">                      </span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">score_plot_xydim</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
        <span class="n">add_score_plot</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">add_score_plot</span> <span class="o">=</span> <span class="kc">True</span>
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span> <span class="c1">#No Xnew was given need to plot all from model</span>
        <span class="k">if</span> <span class="s1">&#39;obsidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">ObsID_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;obsidX&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ObsID_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
                              
        <span class="n">Obs_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="k">if</span> <span class="n">add_score_plot</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">score_plot_xydim</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="n">t_x</span>  <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">score_plot_xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">t_y</span>  <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">score_plot_xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_score_plot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">t2_</span>   <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2&#39;</span><span class="p">]</span>
        <span class="n">spex_</span> <span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX&#39;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">ht2_logscale</span><span class="p">:</span>
            <span class="n">t2_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t2_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spe_logscale</span><span class="p">:</span>
            <span class="n">spex_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">spex_</span><span class="p">)</span>
            
            
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">add_score_plot</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
                <span class="n">spey_</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Obs_num</span><span class="p">,</span> <span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">t2_</span><span class="p">,</span><span class="n">spex</span><span class="o">=</span><span class="n">spex_</span><span class="p">,</span><span class="n">spey</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speY&#39;</span><span class="p">]))</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Obs_num</span><span class="p">,</span> <span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">t2_</span><span class="p">,</span><span class="n">spex</span><span class="o">=</span><span class="n">spex_</span><span class="p">))</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
                <span class="n">spey_</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Obs_num</span><span class="p">,</span> <span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">t2_</span><span class="p">,</span><span class="n">spex</span><span class="o">=</span><span class="n">spex_</span><span class="p">,</span><span class="n">spey</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speY&#39;</span><span class="p">],</span><span class="n">tx</span><span class="o">=</span><span class="n">t_x</span><span class="p">,</span><span class="n">ty</span><span class="o">=</span><span class="n">t_y</span><span class="p">))</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Obs_num</span><span class="p">,</span> <span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">t2_</span><span class="p">,</span><span class="n">spex</span><span class="o">=</span><span class="n">spex_</span><span class="p">,</span><span class="n">tx</span><span class="o">=</span><span class="n">t_x</span><span class="p">,</span><span class="n">ty</span><span class="o">=</span><span class="n">t_y</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1">#Xnew was given</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Xnew</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ObsID_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Xnew</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">X_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Xnew</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">Xnew</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">ObsID_</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            
        
        
        <span class="k">if</span> <span class="n">add_score_plot</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">score_plot_xydim</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>  
                <span class="n">xpred</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">pls_pred</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xpred</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">pca_pred</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">)</span>
            <span class="n">T_matrix</span><span class="o">=</span><span class="n">xpred</span><span class="p">[</span><span class="s1">&#39;Tnew&#39;</span><span class="p">]</span>
            <span class="n">t_x</span>  <span class="o">=</span> <span class="n">T_matrix</span><span class="p">[:,[</span><span class="n">score_plot_xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">t_y</span>  <span class="o">=</span> <span class="n">T_matrix</span><span class="p">[:,[</span><span class="n">score_plot_xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_score_plot</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="n">t2_</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">hott2</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="n">Xnew</span><span class="o">=</span><span class="n">Xnew</span><span class="p">)</span>
        
        <span class="n">Obs_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t2_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Ynew</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="n">spex_</span><span class="p">,</span><span class="n">spey_</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">spe</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="n">Xnew</span><span class="p">,</span><span class="n">Ynew</span><span class="o">=</span><span class="n">Ynew</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spex_</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">spe</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="n">Xnew</span><span class="p">)</span>
            <span class="n">spey_</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="k">if</span> <span class="n">ht2_logscale</span><span class="p">:</span>
            <span class="n">t2_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">t2_</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">spe_logscale</span><span class="p">:</span>
            <span class="n">spex_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">spex_</span><span class="p">)</span>
        <span class="n">ObsNum_</span><span class="o">=</span><span class="p">[]</span>    
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">ObsNum_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
                       
                       
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">add_score_plot</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Ynew</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Obs_num</span><span class="p">,</span> <span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">ObsNum_</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">t2_</span><span class="p">,</span><span class="n">spex</span><span class="o">=</span><span class="n">spex_</span><span class="p">,</span><span class="n">spey</span><span class="o">=</span><span class="n">spey_</span><span class="p">))</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Obs_num</span><span class="p">,</span> <span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">ObsNum_</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">t2_</span><span class="p">,</span><span class="n">spex</span><span class="o">=</span><span class="n">spex_</span><span class="p">))</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Ynew</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Obs_num</span><span class="p">,</span> <span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">ObsNum_</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">t2_</span><span class="p">,</span><span class="n">spex</span><span class="o">=</span><span class="n">spex_</span><span class="p">,</span><span class="n">spey</span><span class="o">=</span><span class="n">spey_</span><span class="p">,</span><span class="n">tx</span><span class="o">=</span><span class="n">t_x</span><span class="p">,</span><span class="n">ty</span><span class="o">=</span><span class="n">t_y</span><span class="p">))</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Obs_num</span><span class="p">,</span> <span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">ObsNum_</span><span class="p">,</span><span class="n">t2</span><span class="o">=</span><span class="n">t2_</span><span class="p">,</span><span class="n">spex</span><span class="o">=</span><span class="n">spex_</span><span class="p">,</span><span class="n">tx</span><span class="o">=</span><span class="n">t_x</span><span class="p">,</span><span class="n">ty</span><span class="o">=</span><span class="n">t_y</span><span class="p">))</span>
    <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,reset,lasso_select&quot;</span>
    <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;Obs #&quot;</span><span class="p">,</span> <span class="s2">&quot;@x&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;Obs: &quot;</span><span class="p">,</span><span class="s2">&quot;@ObsID&quot;</span><span class="p">)</span>
            <span class="p">]</span>
    
    <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))      </span>
    <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>         
    <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Diagnostics&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Diagnostics&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hotelling&#39;s T2&quot;</span><span class="p">)</span>
    <span class="c1">#p.circle(&#39;x&#39;,&#39;t2&#39;,source=source)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;t2&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ht2_logscale</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim95&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim95&#39;</span><span class="p">])],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim99&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim99&#39;</span><span class="p">])],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>        
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim95&#39;</span><span class="p">],</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim95&#39;</span><span class="p">]],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim99&#39;</span><span class="p">],</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim99&#39;</span><span class="p">]],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    
    
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Observation sequence&#39;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;HT2&quot;</span>
    <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
    
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SPE X&#39;</span><span class="p">)</span>
    <span class="c1">#p.circle(&#39;x&#39;,&#39;spex&#39;,source=source)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;spex&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="n">spe_logscale</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim95&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim95&#39;</span><span class="p">])],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim99&#39;</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim99&#39;</span><span class="p">])],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim95&#39;</span><span class="p">],</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim95&#39;</span><span class="p">]],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim99&#39;</span><span class="p">],</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim99&#39;</span><span class="p">]],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Observation sequence&#39;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;SPE X-Space&#39;</span>
    <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Outlier Map&#39;</span><span class="p">)</span>
    <span class="c1">#p.circle(&#39;t2&#39;,&#39;spex&#39;,source=source)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;t2&#39;</span><span class="p">,</span><span class="s1">&#39;spex&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">ht2_logscale</span><span class="p">:</span>
        <span class="n">vline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim99&#39;</span><span class="p">]),</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T2_lim99&#39;</span><span class="p">],</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spe_logscale</span><span class="p">:</span>    
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim99&#39;</span><span class="p">]),</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speX_lim99&#39;</span><span class="p">],</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">vline</span><span class="p">,</span> <span class="n">hline</span><span class="p">])</span>
    
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Hotelling&#39;s T2&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;SPE X-Space&#39;</span>
    <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">spey_</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;SPE Y&#39;</span><span class="p">)</span>
        <span class="c1">#p.circle(&#39;x&#39;,&#39;spey&#39;,source=source)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;spey&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speY_lim95&#39;</span><span class="p">],</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speY_lim95&#39;</span><span class="p">]],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">Obs_num</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speY_lim99&#39;</span><span class="p">],</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;speY_lim99&#39;</span><span class="p">]],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Observation sequence&#39;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;SPE Y-Space&#39;</span>
        <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add_score_plot</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Score Scatter&#39;</span><span class="p">)</span>
        <span class="c1">#p.circle(&#39;tx&#39;, &#39;ty&#39;, source=source,size=7)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span> <span class="s1">&#39;ty&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        
        <span class="n">T_aux1</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">score_plot_xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">T_aux2</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][:,[</span><span class="n">score_plot_xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">T_aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">T_aux1</span><span class="p">,</span><span class="n">T_aux2</span><span class="p">))</span>
        <span class="n">st</span><span class="o">=</span><span class="p">(</span><span class="n">T_aux</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">T_aux</span><span class="p">)</span><span class="o">/</span><span class="n">T_aux</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">[</span><span class="n">xd95</span><span class="p">,</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd95p</span><span class="p">,</span><span class="n">yd95n</span><span class="p">,</span><span class="n">yd99p</span><span class="p">,</span><span class="n">yd99n</span><span class="p">]</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">scores_conf_int_calc</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd95</span><span class="p">,</span><span class="n">yd95p</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd95</span><span class="p">,</span><span class="n">yd95n</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gold&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd99p</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xd99</span><span class="p">,</span><span class="n">yd99n</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span> 
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;t [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">score_plot_xydim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;t [&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">score_plot_xydim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="c1"># Vertical line</span>
        <span class="n">vline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Horizontal line</span>
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">vline</span><span class="p">,</span> <span class="n">hline</span><span class="p">])</span>
        <span class="c1">#Do another p.figure</span>
        <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span> 
    <span class="k">return</span></div>


<div class="viewcode-block" id="predvsobs">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.predvsobs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">predvsobs</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">CLASSID</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">colorby</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">x_space</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;    Plot observed vs predicted values</span>
<span class="sd">    </span>
<span class="sd">    predvsobs(mvmobj,X,Y,*,CLASSID=False,colorby=False,x_space=False)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvmobj: A model created with phi.pca or phi.pls </span>
<span class="sd">        X/Y:     Data [numpy arrays or pandas dataframes] </span>
<span class="sd">        </span>
<span class="sd">    Optional Parameters:</span>
<span class="sd">        CLASSID: Pandas Data Frame with classifiers per observation, each column is a class</span>
<span class="sd">        </span>
<span class="sd">        colorby: one of the classes in CLASSID to color by</span>
<span class="sd">        </span>
<span class="sd">        x_space: = &#39;False&#39; will skip plotting the obs. vs pred for X *default*</span>
<span class="sd">                   &#39;True&#39; will also plot obs vs pred for X</span>
<span class="sd">                   </span>
<span class="sd">   by Salvador Garcia-Munoz </span>
<span class="sd">   (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_varX</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">X_</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ObsID_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">ObsID_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
        <span class="n">XVarID_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">XVarID_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Var #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">X_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">ObsID_</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
        <span class="n">X_</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">k</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">ObsID_</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">ObsID_</span> <span class="o">=</span> <span class="n">ObsID_</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="s1">&#39;varidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">XVar</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varX</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>    
                        
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">num_varY</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;varidY&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">YVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">YVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_varY</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">YVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;YVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                        

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">Y_</span><span class="o">=</span><span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">Y_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

            
    <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>  
        
        <span class="n">pred</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">pls_pred</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">)</span>
        <span class="n">yhat</span><span class="o">=</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;Yhat&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x_space</span><span class="p">:</span>
            <span class="n">xhat</span><span class="o">=</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;Xhat&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xhat</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_space</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">pred</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">pca_pred</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span><span class="n">mvmobj</span><span class="p">)</span>
        <span class="n">xhat</span><span class="o">=</span><span class="n">pred</span><span class="p">[</span><span class="s1">&#39;Xhat&#39;</span><span class="p">]</span>
        <span class="n">yhat</span><span class="o">=</span><span class="kc">False</span>
        
    <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
    <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;$index&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Obs: &quot;</span><span class="p">,</span><span class="s2">&quot;@ObsID&quot;</span><span class="p">)</span>
                <span class="p">]</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span> <span class="c1"># No CLASSIDS</span>
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;ObsvsPred_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;ObsvsPred&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>
        <span class="n">plot_counter</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">yhat</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span> <span class="c1">#skip if PCA model sent</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Y_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">x_</span> <span class="o">=</span> <span class="n">Y_</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">y_</span> <span class="o">=</span> <span class="n">yhat</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>          
                <span class="n">min_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_</span><span class="p">)])</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_</span><span class="p">)])</span>
                
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">))</span>
                <span class="c1">#p = figure(tools=TOOLS, tooltips=TOOLTIPS,width=600, height=600, title=YVar[i])</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">YVar</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">),</span><span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">))</span>
                <span class="c1">#p.circle(&#39;x&#39;, &#39;y&#39;, source=source,size=7,color=&#39;darkblue&#39;)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="n">min_value</span><span class="p">,</span><span class="n">max_value</span><span class="p">],[</span><span class="n">min_value</span><span class="p">,</span><span class="n">max_value</span><span class="p">],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span><span class="s1">&#39;Observed&#39;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span><span class="s1">&#39;Predicted&#39;</span>
                <span class="k">if</span> <span class="n">plot_counter</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">plot_counter</span> <span class="o">=</span> <span class="n">plot_counter</span><span class="o">+</span><span class="mi">1</span>
                
        <span class="k">if</span> <span class="n">x_space</span><span class="p">:</span> <span class="c1">#</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">X_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">x_</span> <span class="o">=</span> <span class="n">X_</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">y_</span> <span class="o">=</span> <span class="n">xhat</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>    
                <span class="n">min_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_</span><span class="p">)])</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_</span><span class="p">)])</span>
 
                <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">))</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">XVar</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">),</span><span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">))</span>
                <span class="c1">#p.circle(&#39;x&#39;, &#39;y&#39;, source=source,size=7,color=&#39;darkblue&#39;)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="n">min_value</span><span class="p">,</span><span class="n">max_value</span><span class="p">],[</span><span class="n">min_value</span><span class="p">,</span><span class="n">max_value</span><span class="p">],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span><span class="s1">&#39;Observed&#39;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span><span class="s1">&#39;Predicted&#39;</span>
                <span class="k">if</span> <span class="n">plot_counter</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">plot_counter</span> <span class="o">=</span> <span class="n">plot_counter</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
        
    <span class="k">else</span><span class="p">:</span> <span class="c1"># YES CLASSIDS</span>
        <span class="c1">#Classes_=np.unique(CLASSID[colorby]).tolist()</span>
        <span class="n">Classes_</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">,</span><span class="n">colorby</span><span class="p">)</span>
        <span class="n">different_colors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">Classes_</span><span class="p">)</span>
        <span class="c1">#colormap =cm.get_cmap(&quot;rainbow&quot;)</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s1">&#39;rainbow&#39;</span><span class="p">]</span>
        <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bokeh_palette</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#</span><span class="si">%02x%02x%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">color_mapping</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span>  
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;ObsvsPred_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;ObsvsPred&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>      
        <span class="n">classid_</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">CLASSID</span><span class="p">[</span><span class="n">colorby</span><span class="p">])</span>
        
        <span class="n">plot_counter</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">yhat</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span> <span class="c1">#skip if PCA model sent</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Y_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">x_</span> <span class="o">=</span> <span class="n">Y_</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">y_</span> <span class="o">=</span> <span class="n">yhat</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">min_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_</span><span class="p">)])</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_</span><span class="p">)])</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">YVar</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">),</span><span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">classid_in_turn</span> <span class="ow">in</span> <span class="n">Classes_</span><span class="p">:</span>
                    <span class="n">x_aux</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">y_aux</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">obsid_aux</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">classid_aux</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">))):</span>
                        <span class="k">if</span> <span class="n">classid_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">classid_in_turn</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                            <span class="n">x_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">y_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">obsid_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">classid_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classid_in_turn</span><span class="p">)</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_aux</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_aux</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">obsid_aux</span><span class="p">,</span><span class="n">Class</span><span class="o">=</span><span class="n">classid_aux</span><span class="p">))</span>        
                    <span class="n">color_</span><span class="o">=</span><span class="n">bokeh_palette</span><span class="p">[</span><span class="n">Classes_</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">classid_in_turn</span><span class="p">)]</span>
                    <span class="c1">#p.circle(&#39;x&#39;,&#39;y&#39;,source=source,color=color_,legend_label=classid_in_turn)</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">,</span><span class="n">legend_label</span><span class="o">=</span><span class="n">classid_in_turn</span><span class="p">)</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="n">min_value</span><span class="p">,</span><span class="n">max_value</span><span class="p">],[</span><span class="n">min_value</span><span class="p">,</span><span class="n">max_value</span><span class="p">],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span><span class="s1">&#39;Observed&#39;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span><span class="s1">&#39;Predicted&#39;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span><span class="o">=</span><span class="s2">&quot;hide&quot;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_left&quot;</span>
                <span class="k">if</span> <span class="n">plot_counter</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                    <span class="n">plot_counter</span> <span class="o">=</span> <span class="n">plot_counter</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
              
        <span class="k">if</span> <span class="n">x_space</span><span class="p">:</span> <span class="c1">#</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">X_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                <span class="n">x_</span> <span class="o">=</span> <span class="n">X_</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">y_</span> <span class="o">=</span> <span class="n">xhat</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">min_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x_</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y_</span><span class="p">)])</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x_</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y_</span><span class="p">)])</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">XVar</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">),</span><span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">classid_in_turn</span> <span class="ow">in</span> <span class="n">Classes_</span><span class="p">:</span>
                    <span class="n">x_aux</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">y_aux</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">obsid_aux</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">classid_aux</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">))):</span>
                        <span class="k">if</span> <span class="n">classid_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">classid_in_turn</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x_</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                            <span class="n">x_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">y_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">obsid_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="n">classid_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classid_in_turn</span><span class="p">)</span>
                    <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_aux</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_aux</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">obsid_aux</span><span class="p">,</span><span class="n">Class</span><span class="o">=</span><span class="n">classid_aux</span><span class="p">))</span>        
                    <span class="n">color_</span><span class="o">=</span><span class="n">bokeh_palette</span><span class="p">[</span><span class="n">Classes_</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">classid_in_turn</span><span class="p">)]</span>
                    <span class="c1">#p.circle(&#39;x&#39;,&#39;y&#39;,source=source,color=color_,legend_label=classid_in_turn)</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color_</span><span class="p">,</span><span class="n">legend_label</span><span class="o">=</span><span class="n">classid_in_turn</span><span class="p">)</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="n">min_value</span><span class="p">,</span><span class="n">max_value</span><span class="p">],[</span><span class="n">min_value</span><span class="p">,</span><span class="n">max_value</span><span class="p">],</span><span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span><span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span><span class="s1">&#39;Observed&#39;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span><span class="s1">&#39;Predicted&#39;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span><span class="o">=</span><span class="s2">&quot;hide&quot;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_left&quot;</span>
                <span class="k">if</span> <span class="n">plot_counter</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                    <span class="n">plot_counter</span> <span class="o">=</span> <span class="n">plot_counter</span><span class="o">+</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>
    <span class="k">return</span>    </div>


<div class="viewcode-block" id="contributions_plot">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.contributions_plot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">contributions_plot</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">cont_type</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">from_obs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">to_obs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">lv_space</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">xgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot contributions to diagnostics</span>
<span class="sd">    </span>
<span class="sd">contributions_plot(mvmobj,X,cont_type,*,Y=False,from_obs=False,to_obs=False,lv_space=False,plotwidth=800,plotheight=600,xgrid=False):</span>

<span class="sd">    Args:</span>
<span class="sd">        mvmobj : A dictionary created by phi.pls or phi.pca    </span>
<span class="sd">        X/Y:     Data [numpy arrays or pandas dataframes] - Y space is optional</span>
<span class="sd">        cont_type: &#39;ht2&#39;</span>
<span class="sd">                   &#39;spe&#39;</span>
<span class="sd">                   &#39;scores&#39;</span>
<span class="sd">        to_obs: Scalar or list of scalars with observation(s) number(s)| first element is #0</span>
<span class="sd">                  - OR -</span>
<span class="sd">                Strings or list of strings with observation(s) name(s) [if X/Y are pandas data frames]</span>
<span class="sd">     </span>
<span class="sd">    Optional Parameters:</span>
<span class="sd">        </span>
<span class="sd">    from_obs: Scalar or list of scalars with observation(s) number(s) | first element is #0</span>
<span class="sd">              - OR -</span>
<span class="sd">              Strings or list of strings with observation(s) name(s) [if X/Y are pandas data frames]</span>
<span class="sd">              Used to off set calculations for scores or ht2</span>
<span class="sd">              &quot;False&#39; will calculate with respect to origin *default if not sent*</span>
<span class="sd">              *Note: from_obs is ignored when cont_type=&#39;spe&#39;*</span>
<span class="sd">            </span>
<span class="sd">    lv_space: Latent spaces over which to do the calculations [applicable to &#39;ht2&#39; and &#39;scores&#39;]</span>
<span class="sd">    </span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">good_to_go</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">ObsID</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">to_obs_</span><span class="o">=</span><span class="n">ObsID</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">to_obs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">to_obs_</span><span class="o">=</span><span class="n">to_obs</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">to_obs_</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">to_obs</span><span class="p">:</span>
                    <span class="n">to_obs_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObsID</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">):</span>
                <span class="n">to_obs_</span><span class="o">=</span><span class="n">to_obs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
            <span class="n">good_to_go</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">from_obs_</span><span class="o">=</span><span class="n">ObsID</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">from_obs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
                <span class="n">from_obs_</span><span class="o">=</span><span class="n">from_obs</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">from_obs_</span><span class="o">=</span><span class="p">[]</span>
                    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">from_obs</span><span class="p">:</span>
                        <span class="n">from_obs_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ObsID</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">):</span>
                    <span class="n">from_obs_</span><span class="o">=</span><span class="n">from_obs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">from_obs_</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">to_obs_</span><span class="o">=</span><span class="n">to_obs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">good_to_go</span><span class="o">=</span><span class="kc">False</span>    
    <span class="k">if</span> <span class="n">cont_type</span><span class="o">==</span><span class="s1">&#39;scores&#39;</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
        <span class="n">Y</span><span class="o">=</span><span class="kc">False</span>
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">good_to_go</span><span class="p">:</span>
        <span class="n">Xconts</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">contributions</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">cont_type</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">from_obs</span><span class="o">=</span><span class="n">from_obs_</span><span class="p">,</span><span class="n">to_obs</span><span class="o">=</span><span class="n">to_obs_</span><span class="p">,</span><span class="n">lv_space</span><span class="o">=</span><span class="n">lv_space</span><span class="p">)</span>
        <span class="n">Yconts</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">elif</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="nb">bool</span><span class="p">))</span> <span class="ow">and</span> <span class="n">good_to_go</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">)</span> <span class="ow">and</span> <span class="n">cont_type</span><span class="o">==</span><span class="s1">&#39;spe&#39;</span><span class="p">:</span>
        <span class="n">Xconts</span><span class="p">,</span><span class="n">Yconts</span><span class="o">=</span><span class="n">phi</span><span class="o">.</span><span class="n">contributions</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">cont_type</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span><span class="n">from_obs</span><span class="o">=</span><span class="n">from_obs_</span><span class="p">,</span><span class="n">to_obs</span><span class="o">=</span><span class="n">to_obs_</span><span class="p">,</span><span class="n">lv_space</span><span class="o">=</span><span class="n">lv_space</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="s1">&#39;varidX&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
        <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidX&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">XVar</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">XVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;XVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               

    <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
    <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
    <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Contributions&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Contributions&#39;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">from_txt</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">from_obs</span><span class="p">))</span>
        <span class="n">from_txt</span><span class="o">=</span><span class="s2">&quot; from obs: &quot;</span><span class="o">+</span><span class="n">from_txt</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
        <span class="n">from_txt</span><span class="o">=</span><span class="s2">&quot; from obs: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">from_obs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">from_obs</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>    
        <span class="n">from_txt</span><span class="o">=</span><span class="s2">&quot; from obs: &quot;</span> <span class="o">+</span> <span class="n">from_obs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">from_txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">to_txt</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">to_obs</span><span class="p">))</span>
        <span class="n">to_txt</span><span class="o">=</span><span class="s2">&quot;, to obs: &quot;</span><span class="o">+</span><span class="n">to_txt</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>    
        <span class="n">to_txt</span><span class="o">=</span><span class="s2">&quot;, to obs: &quot;</span> <span class="o">+</span> <span class="n">to_obs</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_obs</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
        <span class="n">to_txt</span> <span class="o">=</span><span class="s2">&quot;, to obs: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_obs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">to_txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        
    <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Variable&quot;</span><span class="p">,</span><span class="s2">&quot;@names&quot;</span><span class="p">)</span>
                <span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Contributions Plot&quot;</span><span class="o">+</span><span class="n">from_txt</span><span class="o">+</span><span class="n">to_txt</span><span class="p">,</span>
                    <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,pan,reset&quot;</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">)</span>
    
    <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">Xconts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span> 
    <span class="c1">#p.vbar(x=XVar, top=Xconts[0].tolist(), width=0.5)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    
    
    <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
    <span class="k">if</span> <span class="n">xgrid</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>   
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Contributions to &#39;</span><span class="o">+</span><span class="n">cont_type</span>
    <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
    <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">Yconts</span><span class="p">,</span><span class="nb">bool</span><span class="p">)):</span>
        <span class="k">if</span> <span class="s1">&#39;varidY&#39;</span> <span class="ow">in</span> <span class="n">mvmobj</span><span class="p">:</span>
            <span class="n">YVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;varidY&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">YVar</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">YVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;YVar #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>               
        
        <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">YVar</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Contributions Plot&quot;</span><span class="p">,</span>
                    <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,pan,reset&quot;</span><span class="p">)</span>
        <span class="c1">#p.vbar(x=YVar, top=Yconts[0].tolist(), width=0.5)</span>
        <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">YVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">Yconts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">YVar</span><span class="p">))</span> 
        <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>    
        <span class="k">if</span> <span class="n">xgrid</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="s1">&#39;lightgray&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>   
        <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Contributions to &#39;</span><span class="o">+</span><span class="n">cont_type</span>
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
        <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        
    <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>  
    <span class="k">return</span></div>



<div class="viewcode-block" id="mb_weights">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.mb_weights">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mb_weights</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">400</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Super weights for Multi-block models</span>
<span class="sd">    </span>
<span class="sd">    mb_weights(mvmobj,*,plotwidth=600,plotheight=400)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvmobj: A multi-block PLS model created with phi.mbpls</span>
<span class="sd">        </span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;LV #&#39;</span>        
    <span class="n">lv_labels</span> <span class="o">=</span> <span class="p">[]</span>   
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lv_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lv_prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>    
    <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Xblocknames&#39;</span><span class="p">]</span>        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;blockweights_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Block Weights&quot;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>         
        <span class="n">px</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Block weights for MBPLS&quot;</span><span class="o">+</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
             <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,hover,reset&quot;</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Var:&quot;</span><span class="p">,</span><span class="s2">&quot;@x_&quot;</span><span class="p">)],</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">)</span>   
        <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Wt&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span> 
        <span class="n">px</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">px</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">px</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">minor_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Wt&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
        <span class="n">px</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>  
        <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">px</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">px</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">px</span><span class="p">)</span>
    <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>  

    <span class="k">return</span> </div>


<div class="viewcode-block" id="mb_r2pb">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.mb_r2pb">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mb_r2pb</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">400</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;R2 for each block for Multi-block models</span>
<span class="sd">    </span>
<span class="sd">    mb_r2pb(mvmobj,*,plotwidth=600,plotheight=400)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvmobj: A multi-block PLS model created with phi.mbpls</span>
<span class="sd">        </span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lv_prefix</span><span class="o">=</span><span class="s1">&#39;LV #&#39;</span>        
    <span class="n">lv_labels</span> <span class="o">=</span> <span class="p">[]</span>   
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lv_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lv_prefix</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>    
    <span class="n">r2pbX_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;XVar&#39;</span><span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Xblocknames&#39;</span><span class="p">]}</span>
    <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Xblocknames&#39;</span><span class="p">]</span>        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
        <span class="n">r2pbX_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lv_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">:</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2pbX&#39;</span><span class="p">][:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()})</span>
        <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
        <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
        <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;r2perblock&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;R2 per Block&quot;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
        <span class="c1">#colormap =cm.get_cmap(&quot;rainbow&quot;)</span>
        <span class="n">colormap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colormaps</span><span class="p">[</span><span class="s1">&#39;rainbow&#39;</span><span class="p">]</span>
        <span class="n">different_colors</span><span class="o">=</span><span class="n">A</span>
        <span class="n">color_mapping</span><span class="o">=</span><span class="n">colormap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">different_colors</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">bokeh_palette</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#</span><span class="si">%02x%02x%02x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">color_mapping</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span>                 
        <span class="n">px</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;r2 per Block for MBPLS&quot;</span><span class="p">,</span>
             <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,hover,reset&quot;</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="s2">&quot;$name @XVar: @$name&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">)</span>        
        <span class="n">px</span><span class="o">.</span><span class="n">vbar_stack</span><span class="p">(</span><span class="n">lv_labels</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;XVar&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">bokeh_palette</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">r2pbX_dict</span><span class="p">)</span>
        <span class="n">px</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">px</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">minor_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">px</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;R2 per Block per LV&#39;</span>
        <span class="n">px</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>      
    <span class="n">show</span><span class="p">(</span><span class="n">px</span><span class="p">)</span>
    <span class="k">return</span></div>



<div class="viewcode-block" id="mb_vip">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.mb_vip">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mb_vip</span><span class="p">(</span><span class="n">mvmobj</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">400</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;VIP per block for Multi-block models</span>
<span class="sd">    </span>
<span class="sd">    mb_vip(mvmobj,*,plotwidth=600,plotheight=400)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        mvmobj: A multi-block PLS model created with phi.mbpls</span>
<span class="sd">        </span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="o">=</span> <span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
   
    <span class="n">XVar</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Xblocknames&#39;</span><span class="p">]</span>        
    <span class="n">Wt</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;Wt&#39;</span><span class="p">]</span>
    <span class="n">r2y</span><span class="o">=</span><span class="n">mvmobj</span><span class="p">[</span><span class="s1">&#39;r2y&#39;</span><span class="p">]</span>
    <span class="n">vip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Wt</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">A</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
            <span class="n">vip</span><span class="o">=</span><span class="n">vip</span><span class="o">+</span><span class="n">Wt</span><span class="p">[:,[</span><span class="n">a</span><span class="p">]]</span><span class="o">*</span><span class="n">r2y</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vip</span><span class="o">=</span><span class="n">Wt</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="n">r2y</span>
        
    <span class="n">vip</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">vip</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">vip</span><span class="p">)</span>
    <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">XVar_</span><span class="o">=</span><span class="p">[</span><span class="n">XVar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index</span><span class="p">]</span>
    <span class="n">XVar</span> <span class="o">=</span> <span class="n">XVar_</span>
    <span class="n">vip</span><span class="o">=</span><span class="n">vip</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
    <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
    <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;blockvip&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Block VIP&quot;</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
    <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">vip</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">names</span><span class="o">=</span><span class="n">XVar</span><span class="p">))</span>         
    <span class="n">px</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">XVar</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Block VIP for MBPLS&quot;</span><span class="p">,</span>
         <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,hover,reset&quot;</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Block:&quot;</span><span class="p">,</span><span class="s2">&quot;@x_&quot;</span><span class="p">)],</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">)</span>   
    
    <span class="n">px</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">px</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">px</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">px</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">minor_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">px</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">px</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Block VIP&#39;</span>
    <span class="n">px</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>  
    <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">px</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
    <span class="n">show</span><span class="p">(</span><span class="n">px</span><span class="p">)</span>  
    <span class="k">return</span></div>


<div class="viewcode-block" id="barplot">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.barplot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">barplot</span><span class="p">(</span><span class="n">yheights</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">addtitle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">xtick_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">tabtitle</span><span class="o">=</span><span class="s1">&#39;Bar Plot&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Generic Bar plot with Bokeh</span>

<span class="sd">    barplot(yheights,*,plotwidth=600,plotheight=600,</span>
<span class="sd">                addtitle=&#39;&#39;,xlabel=&#39;&#39;,ylabel=&#39;&#39;,xtick_labels=False,tabtitle=&#39;Bar Plot&#39;):</span>

<span class="sd">    Args:</span>
<span class="sd">        yheights: Values of bars</span>
<span class="sd">        xtick_labels: Variable identifiers for x axis</span>
<span class="sd">        </span>
<span class="sd">    by Salvador Garcia-Munoz </span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>
    <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;BarPlot_&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">tabtitle</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span> 
              
    <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Variable&quot;</span><span class="p">,</span><span class="s2">&quot;@names&quot;</span><span class="p">)</span>
                <span class="p">]</span>
    
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">xtick_labels</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">addtitle</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;save,box_zoom,pan,reset&quot;</span><span class="p">,</span><span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">)</span>
    
    <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x_</span><span class="o">=</span><span class="n">xtick_labels</span><span class="p">,</span> <span class="n">y_</span><span class="o">=</span><span class="n">yheights</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">xtick_labels</span><span class="p">))</span> 
    
    <span class="n">p</span><span class="o">.</span><span class="n">vbar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x_&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;y_&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">ylabel</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mi">45</span>
    <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> </div>


<div class="viewcode-block" id="lineplot">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.lineplot">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">lineplot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">col_name</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Main Title&#39;</span><span class="p">,</span><span class="n">tab_title</span><span class="o">=</span><span class="s1">&#39;Tab Title&#39;</span><span class="p">,</span>
             <span class="n">xaxis_label</span><span class="o">=</span><span class="s1">&#39;X- axis&#39;</span><span class="p">,</span><span class="n">plotheight</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span><span class="n">plotwidth</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
             <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;  Simple way to plot a column of a Pandas DataFrame with Bokeh.</span>
<span class="sd">    </span>
<span class="sd">    lineplot(X,col_name,*,plot_title=&#39;Main Title&#39;,tab_title=&#39;Tab Title&#39;,</span>
<span class="sd">                 xaxis_label=&#39;X- axis&#39;,plotheight=400,plotwidth=600,</span>
<span class="sd">                 linecolor=&#39;blue&#39;,linewidth=2,marker=False)</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        </span>
<span class="sd">        X:      A a pandas object with Data to be plotted,first column is obs id</span>
<span class="sd">        col_name: The list with names of the column to plot</span>

<span class="sd">    Optional Parameters:</span>
<span class="sd">    plot_title</span>
<span class="sd">    tab_title</span>
<span class="sd">    xaxis_label</span>
<span class="sd">    yaxis_label</span>
<span class="sd">    plotheight</span>
<span class="sd">    plotwidth</span>
<span class="sd">    </span>
<span class="sd">    Programmed by Salvador Garcia-Munoz</span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">col_name</span><span class="o">=</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
    <span class="n">first_plot</span><span class="o">=</span><span class="kc">True</span>
    
    <span class="n">TOOLS</span> <span class="o">=</span> <span class="s2">&quot;save,wheel_zoom,box_zoom,pan,reset,box_select,lasso_select&quot;</span>
    <span class="n">TOOLTIPS</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Obs #&quot;</span><span class="p">,</span> <span class="s2">&quot;@ObsNum&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;(x,y)&quot;</span><span class="p">,</span> <span class="s2">&quot;($x, $y)&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Obs: &quot;</span><span class="p">,</span><span class="s2">&quot;@ObsID&quot;</span><span class="p">)</span>
                <span class="p">]</span> 
    <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
    <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>          
    <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;LinePlot&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">tab_title</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">this_col_name</span> <span class="ow">in</span> <span class="n">col_name</span><span class="p">:</span>
            <span class="n">ObsID_</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ObsID_</span><span class="o">=</span><span class="n">ObsID_</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">aux</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">this_col_name</span><span class="p">]</span>
            <span class="n">y_</span><span class="o">=</span><span class="n">aux</span><span class="o">.</span><span class="n">values</span>  
            <span class="n">x_</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">ObsNum_</span><span class="o">=</span><span class="p">[]</span>    
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ObsID_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">ObsNum_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Obs #&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>     
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">first_plot</span><span class="p">):</span>                   
                <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;&#39;</span>    
            <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="n">TOOLTIPS</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">plotwidth</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">plotheight</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">plot_title</span><span class="p">)</span>        
            <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_</span><span class="p">,</span><span class="n">ObsID</span><span class="o">=</span><span class="n">ObsID_</span><span class="p">,</span><span class="n">ObsNum</span><span class="o">=</span><span class="n">ObsNum_</span><span class="p">))</span>
            <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">xaxis_label</span>
            <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">this_col_name</span>
            <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span><span class="n">line_color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span><span class="n">line_width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
            <span class="c1">#p.circle(&#39;x&#39;, &#39;y&#39;, source=source)</span>
            <span class="n">hline</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hline</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">marker</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">first_plot</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
                <span class="n">first_plot</span><span class="o">=</span><span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">p_list</span><span class="p">))</span>         
    <span class="k">return</span></div>


<div class="viewcode-block" id="plot_spectra">
<a class="viewcode-back" href="../../pyphi_plots.html#pyphi_plots.pyphi_plots.plot_spectra">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_spectra</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Main Title&#39;</span><span class="p">,</span><span class="n">tab_title</span><span class="o">=</span><span class="s1">&#39;Tab Title&#39;</span><span class="p">,</span>
                 <span class="n">xaxis_label</span><span class="o">=</span><span class="s1">&#39;X- axis&#39;</span><span class="p">,</span><span class="n">yaxis_label</span><span class="o">=</span><span class="s1">&#39;Y- axis&#39;</span><span class="p">,</span>
                 <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simple way to plot Spectra with Bokeh. </span>

<span class="sd">    plot_spectra(X,*,xaxis=False,plot_title=&#39;Main Title&#39;,tab_title=&#39;Tab Title&#39;,</span>
<span class="sd">                     xaxis_label=&#39;X- axis&#39;,yaxis_label=&#39;Y- axis&#39;,</span>
<span class="sd">                     linecolor=&#39;blue&#39;,linewidth=2)</span>
<span class="sd">    Args:</span>
<span class="sd">        </span>
<span class="sd">        X:      A numpy array or a pandas object with Spectra to be plotted</span>
<span class="sd">        xaxis:  wavenumbers or wavelengths to index the x axis of the plot </span>
<span class="sd">                * ignored if X is a pandas dataframe *</span>
<span class="sd">            </span>
<span class="sd">    Optional Parameters: </span>
<span class="sd">        plot_title</span>
<span class="sd">        tab_title</span>
<span class="sd">        xaxis_label</span>
<span class="sd">        yaxis_label</span>
<span class="sd">    </span>
<span class="sd">    Programmed by Salvador Garcia-Munoz</span>
<span class="sd">    (sgarciam@ic.ac.uk ,salvadorgarciamunoz@gmail.com)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">x</span><span class="o">=</span><span class="n">xaxis</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1">#rnd_num=str(int(np.round(1000*np.random.random_sample())))</span>
    <span class="n">rnd_num</span><span class="o">=</span><span class="n">timestr</span><span class="p">()</span>                
    <span class="n">output_file</span><span class="p">(</span><span class="s2">&quot;Spectra&quot;</span><span class="o">+</span><span class="n">rnd_num</span><span class="o">+</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">tab_title</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;inline&#39;</span><span class="p">)</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">plot_title</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">xaxis_label</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="n">yaxis_label</span>
    <span class="n">p</span><span class="o">.</span><span class="n">multi_line</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">*</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="n">line_color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span><span class="n">line_width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
    <span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Salvador Garcia Munoz.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>